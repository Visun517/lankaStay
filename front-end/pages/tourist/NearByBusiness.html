<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Nearby Businesses - LankaStay</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script async defer
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAbK6ZSQgHb67i6tbwwojGFNBkTRBt2dVM&libraries=places&callback=initMap">
  </script>
</head>
<body class="bg-blue-50 min-h-screen">
  <!-- Navigation Bar -->
  <nav class="bg-white shadow-lg px-6 py-4">
    <div class="flex justify-between items-center">
      <h1 class="text-2xl font-bold text-blue-600">LankaStay</h1>
      <div class="flex items-center space-x-4">
        <span class="text-gray-700">Welcome, <span id="userName">Tourist</span></span>
        <a href="TouristDashboard.html" class="text-blue-600 hover:text-blue-800 transition">‚Üê Back to Dashboard</a>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <main class="container mx-auto px-4 py-8">
    <!-- Header Section -->
    <section class="text-center mb-8">
      <h2 class="text-3xl font-bold text-gray-800 mb-4">Nearby Businesses</h2>
      <p class="text-gray-600 mb-6">Discover amazing places within 5km of your location</p>
      
      <!-- Location Status -->
      <div id="locationStatus" class="inline-flex items-center px-4 py-2 bg-blue-100 text-blue-800 rounded-full">
        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
        </svg>
        <span id="statusText">Getting your location...</span>
      </div>
    </section>

    <!-- Category Filters -->
    <section class="mb-8">
      <h3 class="text-xl font-bold text-gray-800 mb-4 text-center">Choose Business Type</h3>
      <div class="flex flex-wrap justify-center gap-4">
        <button class="category-btn active px-6 py-3 rounded-full bg-blue-500 text-white font-semibold shadow-lg hover:bg-blue-600 transition-all duration-200" data-category="all">
          All Businesses
        </button>
        <button class="category-btn px-6 py-3 rounded-full bg-white border-2 border-blue-200 text-blue-600 font-semibold hover:bg-blue-50 transition-all duration-200" data-category="hotel">
          üè® Hotels
        </button>
        <button class="category-btn px-6 py-3 rounded-full bg-white border-2 border-blue-200 text-blue-600 font-semibold hover:bg-blue-50 transition-all duration-200" data-category="restaurant">
          üçΩÔ∏è Restaurants
        </button>
        <button class="category-btn px-6 py-3 rounded-full bg-white border-2 border-blue-200 text-blue-600 font-semibold hover:bg-blue-50 transition-all duration-200" data-category="spa">
          üíÜ Spas
        </button>
        <button class="category-btn px-6 py-3 rounded-full bg-white border-2 border-blue-200 text-blue-600 font-semibold hover:bg-blue-50 transition-all duration-200" data-category="guesthouse">
          üè† Guest Houses
        </button>
      </div>
    </section>

    <!-- Map Container -->
    <section class="mb-8">
      <div class="relative w-full h-[600px] rounded-lg overflow-hidden shadow-lg">
        <!-- Map Background -->
        <div id="map" class="absolute inset-0 z-0"></div>

        <!-- Search Bar -->
        <div class="absolute top-4 left-4 z-20">
          <div class="bg-white bg-opacity-95 rounded-xl shadow-lg p-3 border border-blue-100 backdrop-blur-md">
            <div class="flex items-center gap-2">
              <span class="text-blue-500">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-4.35-4.35M11 19a8 8 0 100-16 8 8 0 000 16z"></path>
                </svg>
              </span>
              <input id="searchInput" type="text" placeholder="Search businesses..." class="px-3 py-1 border-0 focus:ring-2 focus:ring-blue-400 text-gray-700 bg-transparent outline-none w-48">
            </div>
          </div>
        </div>

        <!-- Business Count Display -->
        <div class="absolute top-4 right-4 z-20">
          <div class="bg-white bg-opacity-95 rounded-xl shadow-lg p-3 border border-blue-100 backdrop-blur-md">
            <div class="text-center">
              <p class="text-sm text-gray-600">Found</p>
              <p id="businessCount" class="text-2xl font-bold text-blue-600">0</p>
              <p class="text-sm text-gray-600">businesses</p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Business List -->
    <section class="mb-8">
      <h3 class="text-xl font-bold text-gray-800 mb-4">Nearby Businesses</h3>
      <div id="businessList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
        <!-- Business cards will be populated here -->
      </div>
    </section>
  </main>

  <!-- Business Details Modal -->
  <div id="businessModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 p-6 relative animate-fadeIn">
      <button id="closeModal" class="absolute top-3 right-3 text-gray-400 hover:text-red-500 transition">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
      
      <div id="modalContent">
        <!-- Modal content will be populated here -->
      </div>
    </div>
  </div>

  <style>
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(40px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .animate-fadeIn { animation: fadeIn 0.3s ease; }
    
    .category-btn.active {
      background-color: #3b82f6;
      color: white;
      border-color: #3b82f6;
    }
    
    .business-card {
      transition: all 0.3s ease;
    }
    
    .business-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    }
  </style>

  <script>
    let map;
    let userLocation;
    let markers = [];
    let businesses = [];
    let currentCategory = 'all';

    // Sample business data
    const sampleBusinesses = [
      {
        id: 1,
        name: "Cinnamon Grand Hotel",
        type: "hotel",
        category: "Hotel",
        rating: 4.5,
        price: "$$$",
        distance: 0.8,
        address: "117 Sir Chittampalam A. Gardiner Mawatha, Colombo",
        phone: "+94 11 249 1000",
        description: "Luxury 5-star hotel in the heart of Colombo with stunning ocean views.",
        image: "https://images.unsplash.com/photo-1566073771259-6a8506099945?w=400&h=300&fit=crop",
        coordinates: { lat: 6.9271, lng: 79.8612 }
      },
      {
        id: 2,
        name: "Ministry of Crab",
        type: "restaurant",
        category: "Restaurant",
        rating: 4.8,
        price: "$$",
        distance: 1.2,
        address: "Old Dutch Hospital, Colombo 01",
        phone: "+94 11 234 2722",
        description: "Award-winning seafood restaurant specializing in Sri Lankan crab dishes.",
        image: "https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=400&h=300&fit=crop",
        coordinates: { lat: 6.9285, lng: 79.8618 }
      }
    ];

    // Initialize map
    function initMap() {
      const defaultLocation = { lat: 6.9271, lng: 79.8612 };
      
      map = new google.maps.Map(document.getElementById('map'), {
        zoom: 14,
        center: defaultLocation
      });

      getUserLocation();
    }

    // Get user location
    function getUserLocation() {
      if (navigator.geolocation) {
        document.getElementById('statusText').textContent = 'Getting your location...';
        
        navigator.geolocation.getCurrentPosition(
          function(position) {
            userLocation = {
              lat: position.coords.latitude,
              lng: position.coords.longitude
            };
            
            map.setCenter(userLocation);
            
            // Add user location marker
            new google.maps.Marker({
              position: userLocation,
              map: map,
              title: 'Your Location',
              icon: {
                url: 'data:image/svg+xml;charset=UTF-8,' + encodeURIComponent(`
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="12" cy="12" r="8" fill="#3b82f6" stroke="white" stroke-width="2"/>
                    <circle cx="12" cy="12" r="3" fill="white"/>
                  </svg>
                `),
                scaledSize: new google.maps.Size(24, 24)
              }
            });

            // Add 5km radius circle
            new google.maps.Circle({
              strokeColor: '#3b82f6',
              strokeOpacity: 0.2,
              strokeWeight: 2,
              fillColor: '#3b82f6',
              fillOpacity: 0.1,
              map: map,
              center: userLocation,
              radius: 5000
            });

            document.getElementById('statusText').textContent = 'Location found! Showing nearby businesses';
            loadBusinesses();
          },
          function(error) {
            document.getElementById('statusText').textContent = 'Location access denied. Using default location.';
            userLocation = defaultLocation;
            loadBusinesses();
          }
        );
      } else {
        document.getElementById('statusText').textContent = 'Geolocation not supported. Using default location.';
        userLocation = defaultLocation;
        loadBusinesses();
      }
    }

    // Load businesses
    function loadBusinesses() {
      businesses = sampleBusinesses.filter(business => business.distance <= 5);
      displayBusinesses();
      addMarkersToMap();
      updateBusinessCount();
    }

    // Display businesses in list
    function displayBusinesses() {
      const businessList = document.getElementById('businessList');
      const filteredBusinesses = currentCategory === 'all' 
        ? businesses 
        : businesses.filter(b => b.type === currentCategory);

      businessList.innerHTML = filteredBusinesses.map(business => `
        <div class="business-card bg-white rounded-lg p-4 shadow-md cursor-pointer" onclick="showBusinessDetails(${business.id})">
          <img src="${business.image}" alt="${business.name}" class="w-full h-32 object-cover rounded-lg mb-3">
          <div class="flex justify-between items-start mb-2">
            <h4 class="font-semibold text-gray-800 text-lg">${business.name}</h4>
            <span class="px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full">${business.category}</span>
          </div>
          <div class="flex items-center mb-2">
            <div class="flex text-yellow-400">
              ${'‚òÖ'.repeat(Math.floor(business.rating))}${'‚òÜ'.repeat(5 - Math.floor(business.rating))}
            </div>
            <span class="ml-2 text-sm text-gray-600">${business.rating}</span>
            <span class="ml-auto text-sm text-gray-500">${business.price}</span>
          </div>
          <p class="text-sm text-gray-600 mb-2">${business.address}</p>
          <div class="flex justify-between items-center">
            <span class="text-sm text-blue-600 font-medium">${business.distance} km away</span>
            <button class="px-3 py-1 bg-blue-500 text-white text-sm rounded hover:bg-blue-600 transition">
              View Details
            </button>
          </div>
        </div>
      `).join('');
    }

    // Add markers to map
    function addMarkersToMap() {
      markers.forEach(marker => marker.setMap(null));
      markers = [];

      const filteredBusinesses = currentCategory === 'all' 
        ? businesses 
        : businesses.filter(b => b.type === currentCategory);

      filteredBusinesses.forEach(business => {
        const marker = new google.maps.Marker({
          position: business.coordinates,
          map: map,
          title: business.name
        });

        marker.addListener('click', () => {
          showBusinessDetails(business.id);
        });

        markers.push(marker);
      });
    }

    // Show business details modal
    function showBusinessDetails(businessId) {
      const business = businesses.find(b => b.id === businessId);
      if (!business) return;

      const modal = document.getElementById('businessModal');
      const modalContent = document.getElementById('modalContent');

      modalContent.innerHTML = `
        <img src="${business.image}" alt="${business.name}" class="w-full h-48 object-cover rounded-lg mb-4">
        <h3 class="text-2xl font-bold text-gray-800 mb-2">${business.name}</h3>
        <div class="flex items-center mb-3">
          <div class="flex text-yellow-400">
            ${'‚òÖ'.repeat(Math.floor(business.rating))}${'‚òÜ'.repeat(5 - Math.floor(business.rating))}
          </div>
          <span class="ml-2 text-gray-600">${business.rating} ‚Ä¢ ${business.price}</span>
        </div>
        <p class="text-gray-600 mb-4">${business.description}</p>
        <div class="space-y-2 mb-4">
          <div class="flex items-center">
            <svg class="w-4 h-4 text-gray-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
            </svg>
            <span class="text-sm text-gray-600">${business.address}</span>
          </div>
          <div class="flex items-center">
            <svg class="w-4 h-4 text-gray-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
            </svg>
            <span class="text-sm text-gray-600">${business.phone}</span>
          </div>
          <div class="flex items-center">
            <svg class="w-4 h-4 text-gray-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
            </svg>
            <span class="text-sm text-gray-600">${business.distance} km away</span>
          </div>
        </div>
        <div class="flex gap-3">
          <button class="flex-1 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition">
            Book Now
          </button>
          <button class="flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition">
            Get Directions
          </button>
        </div>
      `;

      modal.classList.remove('hidden');
    }

    // Update business count
    function updateBusinessCount() {
      const filteredBusinesses = currentCategory === 'all' 
        ? businesses 
        : businesses.filter(b => b.type === currentCategory);
      
      document.getElementById('businessCount').textContent = filteredBusinesses.length;
    }

    // Event listeners
    document.addEventListener('DOMContentLoaded', function() {
      // Category filter buttons
      document.querySelectorAll('.category-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
          this.classList.add('active');
          currentCategory = this.dataset.category;
          displayBusinesses();
          addMarkersToMap();
          updateBusinessCount();
        });
      });

      // Close modal
      document.getElementById('closeModal').addEventListener('click', function() {
        document.getElementById('businessModal').classList.add('hidden');
      });

      // Close modal when clicking outside
      document.getElementById('businessModal').addEventListener('click', function(e) {
        if (e.target === this) {
          this.classList.add('hidden');
        }
      });
    });
  </script>
</body>
</html>
